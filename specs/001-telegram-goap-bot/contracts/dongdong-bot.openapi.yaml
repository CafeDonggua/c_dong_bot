openapi: 3.0.3
info:
  title: DongDong Bot Internal API
  version: 1.0.0
  description: |
    內部服務合約，用於描述 Telegram 更新處理與記憶存取的介面。
servers:
  - url: http://localhost
paths:
  /telegram/updates:
    post:
      summary: 接收 Telegram 更新並產生回覆
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TelegramUpdate'
      responses:
        '200':
          description: 回覆內容
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BotReply'
  /memory/save:
    post:
      summary: 寫入記憶條目
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MemorySaveRequest'
      responses:
        '200':
          description: 寫入結果
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MemorySaveResponse'
  /memory/query:
    post:
      summary: 查詢記憶條目
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MemoryQueryRequest'
      responses:
        '200':
          description: 查詢結果
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MemoryQueryResponse'
components:
  schemas:
    TelegramUpdate:
      type: object
      properties:
        update_id:
          type: integer
        message:
          type: object
          properties:
            message_id:
              type: integer
            chat:
              type: object
              properties:
                id:
                  type: integer
                type:
                  type: string
            text:
              type: string
      required: [update_id, message]
    BotReply:
      type: object
      properties:
        text:
          type: string
        stop_reason:
          type: string
      required: [text]
    MemorySaveRequest:
      type: object
      properties:
        content:
          type: string
        date:
          type: string
          format: date
      required: [content, date]
    MemorySaveResponse:
      type: object
      properties:
        saved:
          type: boolean
        file_path:
          type: string
      required: [saved, file_path]
    MemoryQueryRequest:
      type: object
      properties:
        query:
          type: string
        date:
          type: string
          format: date
        date_range:
          type: object
          properties:
            start:
              type: string
              format: date
            end:
              type: string
              format: date
      required: [query]
    MemoryQueryResponse:
      type: object
      properties:
        results:
          type: array
          items:
            type: string
      required: [results]
