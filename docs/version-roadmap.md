# Version Roadmap

> 目前穩定版：`1.0.0`  
> 此文件用於後續版本規劃與進度追蹤（可作為每次迭代的對照基準）。

## 版本策略

- `1.x`：在不破壞現有操作習慣下，持續擴充能力與穩定性。

## 路線圖總覽

| 版本 | 階段目標 | 主要範圍 | 狀態 |
| --- | --- | --- | --- |
| 1.1.0 | Cron 自然語句化與相容路由 | 保留舊行程功能 + 新增自然語句 Cron 路由 | Planned |
| 1.2.0 | Heartbeat 主動任務 | 定時讀取 HEARTBEAT 任務檔並執行例行工作 | Planned |
| 1.3.0 | 長任務背景化 | 搜尋整理/報告改為背景工作，先回「已受理」 | Planned |
| 1.4.0 | 體驗與穩定性強化 | 回覆一致性、觀測與錯誤回復能力優化 | Planned |

## 版本明細

## 1.1.0 Cron 自然語句化與相容路由

### 目標
- 提升建立定時任務的可用性，讓使用者可直接用自然語句建立 Cron 任務。
- 避免與既有行程功能衝突，採「保留舊功能 + 智慧分流」策略。

### 範圍
- 新增自然語句 Cron 路由（例：`每天 9 點提醒我喝水`、`每 30 分鐘提醒站起來`）。
- 保留既有行程建立/查詢/修改流程（schedule parser/service 不移除）。
- 路由規則：
  - 重複型語意（每天、每週、每隔 N 分鐘）優先轉 Cron。
  - 單次事件（明天 14:00 開會）維持走行程。
- `/cron` 命令式語法持續保留，作為精準控制入口。

### 驗收指標
- 自然語句建立重複任務成功率 >= 95%（既定測試語料）。
- `/cron add ...` 既有語法相容率 100%（回歸測試）。
- 與 schedule 功能無衝突（新增/查詢/修改回歸全綠）。

## 1.2.0 Heartbeat 主動任務

### 目標
- 讓 bot 可在無使用者訊息時，依規則主動執行例行任務。

### 範圍
- 新增 `data/HEARTBEAT.md` 任務來源格式。
- Heartbeat 執行器：定時讀取任務並觸發（摘要、巡檢、提醒）。
- 執行紀錄與錯誤紀錄落地（檔案或既有 monitoring）。

### 驗收指標
- 重啟後 Heartbeat 任務仍可持續執行。
- 任務成功/失敗有可追蹤紀錄。
- 不影響一般對話回應流程。

## 1.3.0 長任務背景化

### 目標
- 降低對話阻塞與 Telegram Timeout 機率。

### 範圍
- 搜尋整理/報告生成改為背景任務佇列。
- 前台即時回覆「已受理，完成後通知」。
- 完成後透過 Telegram 主動回傳結果。

### 驗收指標
- 長任務流程中，前台首回覆時間 < 2 秒（目標值）。
- 背景任務具備失敗重試與可觀測狀態。
- 既有同步流程回歸測試可持續通過。

## 1.4.0 體驗與穩定性強化

### 目標
- 降低使用者感知延遲、提升回覆一致性與錯誤可恢復性。

### 範圍
- 回覆格式與語氣一致性規則收斂（避免同意圖不同風格）。
- 針對 timeout/conflict 增加自動偵測與提示改善。
- 補齊高風險流程回歸案例（搜尋、記憶查詢、cron 觸發通知）。

### 驗收指標
- 關鍵互動流程平均回覆時間下降（以 perf log 比較基準版）。
- 已知高頻錯誤（TimedOut/Conflict）可被快速辨識與定位。
- 使用者端回報的流程中斷問題顯著下降（版本對照）。

## 進度更新規則

- 每完成一版，更新：
  - `VERSION`
  - `docs/release-notes.md`
  - 本檔狀態欄位（`Planned` -> `In Progress` -> `Done`）
- 每一版至少保留：
  - 1 份可重跑的測試證據（指令 + 結果）
  - 1 份風險與回滾說明（簡版即可）
